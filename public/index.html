<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Scribbles</title>
    <link rel="stylesheet" href="https://cdn.rawgit.com/tklepzig/flex-layout/master/dist/flex-layout.min.css">
    <style>
    html {
        min-height: 100%;
        height: 100%;
    }
    body {
        background: #1d1d1d;
        color: #ededed;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    textarea {
        padding: 12px;
        font-size: 12pt;
        background: inherit;
        border: none;
        outline: none;
        resize: none;
        font-family: inherit;
        color: inherit;
        transition: opacity 0.8s ease-in-out;
        opacity: 0;
    }
    textarea.ready {
        opacity: 1;
    }
    </style>
</head>

<body class="layout-v layout-fill">
    <textarea autofocus class="flex"></textarea>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        var socket = io();
        var path = window.location.pathname;
        var pathArray = path.split('/');
        var id = pathArray.pop();
        if (id.length === 0) {
            id = pathArray.pop();
        }

        socket.emit('load', id, function (text) {
            $('textarea').val(text);
            $('textarea').addClass('ready');
        });

        $('textarea').on('input', function () {
            socket.emit('change', { id: id, text: $('textarea').val() });
        });

        socket.on('change', function (e) {
            if (e.id === id) {
                $('textarea').val(e.text);
            }
        });
    </script>
</body>

</html>